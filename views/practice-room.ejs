<html>
  <head>
    <!-- Stylesheets in here -->
    <link rel="stylesheet" href="/stylesheets/practice-room.css">
    <script src="/javascripts/aframe-master.js"></script>
    <script src="/javascripts/aframe-physics-system.min.js"></script>
    <script src="/javascripts/aframe-extras.min.js"></script>
    
    <script src="/javascripts/networked-aframe.min.js"></script>
    <script src="/javascripts/super-hands.min.js"></script>
    <script src="/javascripts/tt-ball.js"></script>
  </head>
  <body>
    <script src="/javascripts/socket.io.min.js"></script>
    <script src="/javascripts/easyrtc.js"></script>
    <a-scene id="game" networked-scene=<%- '"room:' + roomName + '; debug: true; adapter:easyrtc; audio:true;"'%>>
      <a-assets>
        <img id="groundTexture" src="images/textures/hex_grid.png">
        <a-asset-item id="tt-table-model" src="/models/table_tennis_table.gltf"></a-asset-item>
        <a-asset-item id="tt-net-model" src="/models/table_tennis_net.gltf"></a-asset-item>
        <a-asset-item id="tt-racket-model" src="/models/table_tennis_racket.gltf"></a-asset-item>
        <template id="avatar-template">
          <a-sphere networked-audio-source="positional:false"></a-sphere>
       </template>
      </a-assets>
      <a-entity id="player" networked="template:#player-template;attachTemplateToLocal:false;" spawn-in-circle="radius:3" wasd-controls>
        <a-entity camera="userHeight: 1.6" look-controls networked="template:#head-template;attachTemplateToLocal:false;">
            <a-sphere class="head"
              random-color
              visible="false"
            ></a-sphere>
        </a-entity>
        <a-entity id="rhand" mixin="touch"
                  vive-controls="hand: right"
                  oculus-touch-controls="hand: right"
                  windows-motion-controls="hand: right">
        </a-entity>
        <a-entity id="lhand" mixin="touch"
                  vive-controls="hand: left"
                  oculus-touch-controls="hand: left"
                  windows-motion-controls="hand: left">
        </a-entity>
      </a-entity>

      <a-entity static-body="shape: box" gltf-model="#tt-table-model" position = "0 0 -2"></a-entity>
      <a-entity gltf-model="#tt-net-model" position = "0 0 -2"></a-entity>

      <a-entity gltf-model="#tt-racket-model" grabbable dynamic-body="shape: box;mass: 1" position="0 2 -2"></a-entity>
      <a-entity gltf-model="#tt-racket-model" grabbable dynamic-body="shape: box;mass: 1" position="0 2 -2"></a-entity>
      <a-entity gltf-model="#tt-racket-model" grabbable dynamic-body="shape: box;mass: 1" position="0 2 -2"></a-entity>
      <a-entity gltf-model="#tt-racket-model" grabbable dynamic-body="shape: box;mass: 1" position="0 2 -2"></a-entity>

      <a-sphere dynamic-body="mass: 0.1" color="#ffffff" tt-ball scale="0.03 0.03 0.03" grabbable position="0 1 0"></a-sphere>

      <a-plane static-body src="#groundTexture" material="roughness: 0.6;" rotation="-90 0 0" width="30" height="30" repeat="23 20"></a-plane>

      <a-sky></a-sky>

    </a-scene>

    <script>
      // Define custom schema for syncing avatar color, set by random-color
      NAF.schemas.add({
        template: '#avatar-template',
        components: [
          'position',
          'rotation',
          {
            selector: '.head',
            component: 'material',
            property: 'color'
          }
        ]
      });

      function onConnect () {
        console.log("onConnect", new Date());
      }
    </script>

    <footer>
      
    </footer>
  </body>
</html>
